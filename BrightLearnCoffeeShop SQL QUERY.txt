SELECT MIN(TRANSACTION_TIME), MAX(TRANSACTION_TIME)
FROM
  "COFFEESHOPDB"."COFFEESHOPSCHEMA"."TRANSACTIONS";
  
SELECT
  --AGGREGATES
  COUNT(DISTINCT transaction_id) AS number_of_sales,
  SUM(transaction_qty * unit_price) AS total_revenue,
  SUM(transaction_qty) AS no_units_sold,

  --DATES
  TO_DATE(TRANSACTION_DATE) AS PURCHASEDATE,
  TO_CHAR(TO_DATE(transaction_date), 'YYYYMM') AS MONTH_ID,
  DAYNAME(TO_DATE(TRANSACTION_DATE)) as DAY_OF_WEEK,
    YEAR(transaction_date) AS BY_YEARS,

  --TIME
  CASE
   WHEN TRANSACTION_TIME BETWEEN '06:00:00' AND '11:59:59' THEN 'MORNING'
   WHEN TRANSACTION_TIME BETWEEN '12:00:00' AND '16:59:59' THEN 'AFTERNOON'
   WHEN TRANSACTION_TIME BETWEEN '17:00:00' AND '20:59:59' THEN 'EVENING'
  ELSE 'NIGHT' 
  END AS TIME_BUCKET,

CASE
   WHEN SUM(transaction_qty * unit_price) BETWEEN 0 AND 10 THEN 'LOW'
   WHEN SUM(transaction_qty * unit_price) BETWEEN 11 AND 49 THEN 'MEDIUM'
  ELSE 'HIGH' 
  END AS SPENDER_BUCKET,
  
 CASE
    WHEN DAYNAME(transaction_date) IN ('Sat', 'Sun') THEN 'Weekend'
    ELSE 'Weekday'
  END AS day_bucket,
    CASE
    WHEN MONTH(transaction_date) BETWEEN 1 AND 3 THEN 'Q1'
    WHEN MONTH(transaction_date) BETWEEN 4 AND 6 THEN 'Q2'
    WHEN MONTH(transaction_date) BETWEEN 7 AND 9 THEN 'Q3'
    ELSE 'Q4'
  END AS month_bucket,
  
   --GROUP BY
  STORE_LOCATION, PRODUCT_CATEGORY, PRODUCT_DETAIL,PRODUCT_TYPE, TRANSACTION_ID
FROM
  "COFFEESHOPDB"."COFFEESHOPSCHEMA"."TRANSACTIONS"
GROUP BY
TIME_BUCKET,day_bucket, BY_YEARS,month_bucket, PURCHASEDATE, MONTH_ID, DAY_OF_WEEK,
STORE_LOCATION, PRODUCT_CATEGORY, PRODUCT_DETAIL,PRODUCT_TYPE, TRANSACTION_ID
HAVING SUM(transaction_qty * unit_price) > 0;
